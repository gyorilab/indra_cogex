{% extends "base_form.html" %}
{% import "bootstrap4/form.html" as wtf %}

{% block title %}Discrete Gene Set Analysis{% endblock %}

{% block header %}Gene Set Analysis{% endblock %}

{% block styles %}
    {{ super() }}
    <style>
        /* Enhanced toggle switch styling for INDRA path-based analysis */
        .custom-switch-lg {
            padding-left: 0;
            display: flex;
            align-items: center;
            min-height: 1.75rem;
        }

        .custom-switch-lg .custom-control-input {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }

        .custom-switch-lg .custom-control-label {
            position: relative;
            margin-bottom: 0;
            padding-left: 4.5rem;
            font-weight: 600;
            font-size: 1.05rem;
            cursor: pointer;
            line-height: 1.75rem;
        }

        .custom-switch-lg .custom-control-label::before {
            position: absolute;
            left: 0;
            top: 0;
            display: block;
            width: 3.5rem;
            height: 1.75rem;
            pointer-events: all;
            content: "";
            background-color: #dee2e6;
            border: 1px solid #adb5bd;
            border-radius: 1.75rem;
            transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out;
        }

        .custom-switch-lg .custom-control-label::after {
            position: absolute;
            top: 0.125rem;
            left: 0.125rem;
            display: block;
            width: 1.5rem;
            height: 1.5rem;
            content: "";
            background-color: #fff;
            border-radius: 50%;
            transition: transform 0.15s ease-in-out, background-color 0.15s ease-in-out;
        }

        .custom-switch-lg .custom-control-input:checked ~ .custom-control-label::before {
            background-color: #007bff;
            border-color: #007bff;
        }

        .custom-switch-lg .custom-control-input:checked ~ .custom-control-label::after {
            transform: translateX(1.75rem);
        }

        /* Highlight wrapper for the toggle */
        .toggle-highlight-wrapper {
            margin: 1rem 0;
            padding: 0.75rem;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
        }
    </style>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        function exampleGenes() {
            document.getElementById('{{ form.genes.name }}').value = "{{ example_hgnc_ids }}";
        }

        // Convert INDRA path analysis checkbox to toggle switch
        document.addEventListener('DOMContentLoaded', function() {
            const checkbox = document.getElementById('indra_path_analysis');
            if (checkbox) {
                const formGroup = checkbox.closest('.form-group');
                if (formGroup) {
                    const label = formGroup.querySelector('label[for="indra_path_analysis"]');
                    if (label && !formGroup.querySelector('.custom-switch-lg')) {
                        // Create wrapper div
                        const wrapper = document.createElement('div');
                        wrapper.className = 'toggle-highlight-wrapper';

                        // Create custom-control structure
                        const customControl = document.createElement('div');
                        customControl.className = 'custom-control custom-switch custom-switch-lg';

                        // Move checkbox and add custom-control-input class
                        checkbox.classList.add('custom-control-input');
                        customControl.appendChild(checkbox);

                        // Update label structure
                        label.classList.add('custom-control-label');
                        label.setAttribute('for', checkbox.id);
                        customControl.appendChild(label);

                        // Wrap in highlight box
                        wrapper.appendChild(customControl);

                        // Replace form group content
                        formGroup.innerHTML = '';
                        formGroup.appendChild(wrapper);
                    }
                }
            }
        });
    </script>
{% endblock %}

{% block lead %}
    This application performs gene set enrichment analysis using
    INDRA CoGEx, an automatically assembled biomedical knowledge graph
    consisting of causal, ontological, and property relationships,
    as well as relationships representing data. Given a list of genes
    as input the application ranks and lists GO terms, Reactome
    pathways, WikiPathway pathways, as well as upstream or downstream
    biological entities (e.g., genes/proteins, small molecules, biological
    processes) with respect to the input genes. Ranking
    is based on the overlap between the input genes and the gene sets
    corresponding to each listed term (e.g., the genes annotated
    with a given GO term or the genes that are part of a given
    Reactome pathway). <i>p</i>-values are calculated using Fisher's exact
    test with different options available to adjust for multiple hypothesis testing.
    <br>
    <br>
    The corresponding REST API endpoint for this analysis is
    <code>/api/discrete_analysis</code>. You can find it on the <a href="/apidocs">API
    Docs</a> under the section 'Analysis Queries'.
{% endblock %}